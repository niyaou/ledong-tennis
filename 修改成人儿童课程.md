# 课程增加成人/儿童字段实施计划

## 一、数据库修改

### 1.1 添加数据库字段

在 `course` 表中添加新字段 `is_adult`：

- 类型：`tinyint(1)` 
- 默认值：`1` (默认成人课程)
- 注释：`1=成人课程, 0=儿童课程`
- 位置：在 `course_type` 字段之后

### 1.2 数据迁移脚本

为现有课程数据设置默认值（建议默认为成人课程）：

```sql
ALTER TABLE course ADD COLUMN is_adult tinyint(1) DEFAULT 1 COMMENT '1=成人课程, 0=儿童课程' AFTER course_type;
```

## 二、后台接口修改（workship 工程）

### 2.1 实体类修改

- **文件**: `workship/src/main/java/com/ledong/entity/Course.java`
  - 添加字段：`private Integer isAdult;`
  - 在 `fromBO` 方法中添加字段映射

### 2.2 BO 类修改

- **文件**: `workship/src/main/java/com/ledong/bo/CourseBo.java`
  - 添加字段：`private Integer isAdult;`

### 2.3 Service 层修改

- **文件**: `workship/src/main/java/com/ledong/service/CourseCases.java`
  - `createCourse` 方法添加参数 `Integer isAdult`
  - 在构建 `CourseBo` 时设置 `isAdult` 字段

### 2.4 Controller 层修改

- **文件**: `workship/src/main/java/com/ledong/rest/PrepaidCardController.java`
  - `/api/prepaidCard/course/create` 接口添加 `@RequestParam Integer isAdult` 参数
  - 将参数传递给 `courseCases.createCourse` 方法

### 2.5 DTO 修改（可选）

- **文件**: `workship/src/main/java/com/ledong/entity/response/CourseResponseDTO.java`
  - 如需返回该字段，添加 `private Integer isAdult;`

## 三、前端修改（material-kit-react 工程）

### 3.1 Excel 导入功能修改

- **文件**: `material-kit-react/src/components/searchComponent/autoloading.tsx`
  - Excel 列顺序调整：在"已报名"（第 8 列，索引 8）之后、"学员1"（原第 9 列，索引 9）之前插入新列
  - 修改 `handleSubmitCourse` 函数：
    - 从 `item[8]` 读取成人/儿童字段（"成人"或"儿童"）
    - 转换为数值：`isAdult = item[8] === '成人' ? 1 : 0`
    - 学员数据索引从 `item[11]` 调整为 `item[12]`（因为插入了一列）
    - 学员循环计算：`Math.ceil((item.length - 12) / 5)`（原为 11）
    - 学员数据索引：`item[i * 5 + 12]`（原为 `item[i * 5 + 11]`）

### 3.2 表单填写功能修改

- **文件**: `material-kit-react/src/components/fileExplore/additions.tsx`
  - 在 `courseEdit` 初始化中添加 `isAdult: 1`（默认成人）
  - 在表单中添加选择框（在"课时类型"选择框之后）：
    ```tsx
    <FormControl sx={{ width: '100%' }}>
      <InputLabel>课程类型</InputLabel>
      <Select
        value={courseEdit.isAdult}
        onChange={(e) => {
          let after = { ...courseEdit, isAdult: e.target.value };
          setCourseEdit(after);
        }}
      >
        <MenuItem value={1}>成人课程</MenuItem>
        <MenuItem value={0}>儿童课程</MenuItem>
      </Select>
    </FormControl>
    ```


### 3.3 API 调用修改

- **文件**: `material-kit-react/src/store/slices/dominationSlice.ts`
  - 在 `createCard` 异步 thunk 中：
    - 添加 `formdata.append("isAdult", payload.isAdult || 1)`（默认值为 1）

## 四、Excel 模板说明

新的 Excel 列顺序应为：

1. 课程名称（索引 0）
2. 开始时间（索引 1）
3. 结束时间（索引 2）
4. 场地（索引 3）
5. 教练（索引 4）
6. 价格（索引 5）
7. 人数（索引 6）
8. 已报名（索引 7）
9. **课程类型（索引 8）** ← 新增：填写"成人"或"儿童"
10. 学员1（索引 9）
11. 学员1-课型（索引 10）
12. 学员1-扣费数量（索引 11）
13. 学员1-等效价格（索引 12）
14. 学员1-上课人数（索引 13）
15. 学员2（索引 14）

... 以此类推

## 五、注意事项

1. **向后兼容**：如果 Excel 中缺少该字段（旧模板），默认设置为成人课程（1）
2. **数据验证**：前端和后端都需要验证 `isAdult` 的值（0 或 1）
3. **默认值**：所有现有课程和新创建课程（未指定时）默认为成人课程
4. **数据库迁移**：建议在非业务时间执行，避免影响现有功能