<!--pages/orderDisplay/orderDisplay.wxml-->
<wxs src="./orderDisplay.wxs" module="utils" />
<view class="container">
  <!-- ç®¡ç†å‘˜ç±»å‹æç¤º -->
  <view class="admin-info" wx:if="{{isAdmin}}">
    <text class="admin-text">
      {{isSpecialManager ? 'ç‰¹æ®Šç®¡ç†å‘˜' : 'æ™®é€šç®¡ç†å‘˜'}} - æŸ¥çœ‹è®¢å•åˆ—è¡¨
    </text>
  </view>
  
  <view class="order-list">
    <block wx:for="{{orderList}}" wx:key="index">
      <view class="order-item {{ item.status === 'PAIDED' ? 'paided' :  ''}}" bindtap="onOrderItemClick" data-order="{{item}}">
        <view class="order-header">
          <text class="order-time">åˆ›å»ºæ—¶é—´: {{utils.formatTime(item.createTime)}}</text>
          <text class="campus-info" wx:if="{{item.campus}}">æ ¡åŒº: {{item.campus}}</text>
        </view>
        <view class="order-content">
          <view class="order-main">
            <view class="court-list">
              <block wx:for="{{item.court_ids}}" wx:for-item="court" wx:key="*this">
                <view class="court-module">
                  <text class="court-icon">ğŸ¸</text>
                  <text>{{court}}</text>
                </view>
              </block>
            </view>
            <view class="order-actions">
         
              <block wx:if="{{item.status === 'PAIDED' }}">
                <view class="action-btn refund-btn" catchtap="onRefundClick" data-order="{{item}}" >é€€æ¬¾</view>
              </block>
            </view>
          </view>
          <view class="order-details">
            <text class="total-fee">æ€»ä»·: ï¿¥{{item.total_fee}}</text>
            <text class="status">çŠ¶æ€: {{item.status === 'PENDING' ? 'å¾…æ”¯ä»˜' : item.status === 'PAIDED' ? 'å·²æ”¯ä»˜' : item.status}}</text>
          </view>
        </view>
      </view>
    </block>
  </view>
  <view class="pagination">
    <button bindtap="prevPage" disabled="{{pageNum <= 1}}">ä¸Šä¸€é¡µ</button>
    <text>ç¬¬ {{pageNum}} é¡µ</text>
    <button bindtap="nextPage" disabled="{{!hasMore}}">ä¸‹ä¸€é¡µ</button>
  </view>
  <view wx:if="{{!hasMore}}" class="no-more">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</view>
</view>

<!-- ç®¡ç†å‘˜é€€æ¬¾å¯†ç è¾“å…¥æ¨¡æ€æ¡† -->
<view class="modal-overlay" wx:if="{{showRefundModal}}" bindtap="onModalOverlayClick">
  <view class="modal-content" catchtap="onModalContentClick">
    <view class="modal-header">
      <text class="modal-title">ç®¡ç†å‘˜é€€æ¬¾</text>
      <view class="modal-close" bindtap="onCloseModal">Ã—</view>
    </view>
    <view class="modal-body">
      <view class="input-group">
        <text class="input-label">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼š</text>
        <input 
          class="password-input" 
          type="password" 
          placeholder="è¯·è¾“å…¥å¯†ç " 
          value="{{adminPassword}}"
          bindinput="onPasswordInput"
          focus="{{showRefundModal}}"
        />
      </view>
      <view class="order-info">
        <text class="order-info-text">è®¢å•å·ï¼š{{currentOrder.outTradeNo || 'æœªçŸ¥'}}</text>
        <text class="order-info-text">é‡‘é¢ï¼šï¿¥{{currentOrder.total_fee || 0}}</text>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="onCloseModal">å–æ¶ˆ</button>
      <button class="btn-confirm" bindtap="onConfirmRefund" loading="{{refunding}}">ç¡®è®¤é€€æ¬¾</button>
    </view>
  </view>
</view> 